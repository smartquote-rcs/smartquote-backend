### ============================================
### TESTES DO SISTEMA DE AUDIT LOGS
### ============================================
### Variáveis de ambiente
@baseUrl = http://localhost:3000
@token = SEU_TOKEN_JWT_AQUI
@userId = SEU_USER_UUID_AQUI

### ============================================
### 1. CRIAR LOG DE AUDITORIA
### ============================================
POST {{baseUrl}}/audit-logs
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "user_id": "{{userId}}",
  "action": "CREATE_QUOTE",
  "tabela_afetada": "cotacoes",
  "registo_id": 123,
  "detalhes_alteracao": {
    "descricao": "Nova cotação de teste",
    "valor_total": 15000.00,
    "numero_itens": 5
  }
}

### ============================================
### 2. CRIAR LOG DE LOGIN
### ============================================
POST {{baseUrl}}/audit-logs
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "user_id": "{{userId}}",
  "action": "USER_LOGIN",
  "detalhes_alteracao": {
    "ip": "192.168.1.100",
    "user_agent": "PostmanRuntime/7.33.0",
    "sucesso": true
  }
}

### ============================================
### 3. CRIAR LOG DE ATUALIZAÇÃO DE PRODUTO
### ============================================
POST {{baseUrl}}/audit-logs
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "user_id": "{{userId}}",
  "action": "UPDATE_PRODUCT",
  "tabela_afetada": "produtos",
  "registo_id": 456,
  "detalhes_alteracao": {
    "campos_alterados": ["preco", "estoque"],
    "valores_anteriores": {
      "preco": 100.00,
      "estoque": 50
    },
    "valores_novos": {
      "preco": 120.00,
      "estoque": 45
    }
  }
}

### ============================================
### 4. LISTAR TODOS OS LOGS (COM PAGINAÇÃO)
### ============================================
GET {{baseUrl}}/audit-logs?limit=20&offset=0
Authorization: Bearer {{token}}

### ============================================
### 5. BUSCAR LOGS POR USUÁRIO
### ============================================
GET {{baseUrl}}/audit-logs/user/{{userId}}?limit=50&offset=0
Authorization: Bearer {{token}}

### ============================================
### 6. BUSCAR LOGS POR AÇÃO
### ============================================
GET {{baseUrl}}/audit-logs/action/CREATE_QUOTE?limit=50
Authorization: Bearer {{token}}

### ============================================
### 7. BUSCAR LOGS POR TABELA
### ============================================
GET {{baseUrl}}/audit-logs/table/cotacoes?limit=50
Authorization: Bearer {{token}}

### ============================================
### 8. BUSCAR LOGS DE UM REGISTRO ESPECÍFICO
### ============================================
GET {{baseUrl}}/audit-logs/record/cotacoes/123?limit=100
Authorization: Bearer {{token}}

### ============================================
### 9. BUSCAR LOG POR ID
### ============================================
GET {{baseUrl}}/audit-logs/1
Authorization: Bearer {{token}}

### ============================================
### 10. BUSCAR LOGS COM FILTROS AVANÇADOS
### ============================================
GET {{baseUrl}}/audit-logs?user_id={{userId}}&action=UPDATE_PRODUCT&tabela_afetada=produtos&start_date=2025-01-01T00:00:00Z&end_date=2025-12-31T23:59:59Z&limit=100
Authorization: Bearer {{token}}

### ============================================
### 11. BUSCAR LOGS POR PERÍODO
### ============================================
GET {{baseUrl}}/audit-logs?start_date=2025-11-01T00:00:00Z&end_date=2025-11-07T23:59:59Z&limit=100
Authorization: Bearer {{token}}

### ============================================
### 12. OBTER ESTATÍSTICAS GERAIS
### ============================================
GET {{baseUrl}}/audit-logs/statistics
Authorization: Bearer {{token}}

### ============================================
### 13. OBTER ESTATÍSTICAS POR PERÍODO
### ============================================
GET {{baseUrl}}/audit-logs/statistics?start_date=2025-01-01T00:00:00Z&end_date=2025-12-31T23:59:59Z
Authorization: Bearer {{token}}

### ============================================
### 14. LIMPAR LOGS ANTIGOS (MÍNIMO 30 DIAS)
### ⚠️ CUIDADO: ESTA OPERAÇÃO DELETA DADOS!
### ============================================
DELETE {{baseUrl}}/audit-logs/cleanup/90
Authorization: Bearer {{token}}

### ============================================
### 15. TESTE DE ERRO: TENTAR DELETAR COM MENOS DE 30 DIAS
### ============================================
DELETE {{baseUrl}}/audit-logs/cleanup/15
Authorization: Bearer {{token}}

### ============================================
### 16. TESTE DE ERRO: CRIAR LOG SEM user_id
### ============================================
POST {{baseUrl}}/audit-logs
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "action": "TEST_ACTION"
}

### ============================================
### 17. TESTE DE ERRO: CRIAR LOG SEM action
### ============================================
POST {{baseUrl}}/audit-logs
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "user_id": "{{userId}}"
}

### ============================================
### 18. CRIAR MÚLTIPLOS LOGS PARA TESTE
### ============================================

### Log 1: Criação de fornecedor
POST {{baseUrl}}/audit-logs
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "user_id": "{{userId}}",
  "action": "CREATE_SUPPLIER",
  "tabela_afetada": "fornecedores",
  "registo_id": 10,
  "detalhes_alteracao": {
    "nome": "Fornecedor Teste Ltda",
    "cnpj": "12.345.678/0001-90"
  }
}

###

### Log 2: Exclusão de produto
POST {{baseUrl}}/audit-logs
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "user_id": "{{userId}}",
  "action": "DELETE_PRODUCT",
  "tabela_afetada": "produtos",
  "registo_id": 789,
  "detalhes_alteracao": {
    "motivo": "Produto descontinuado",
    "nome_produto": "Produto XYZ"
  }
}

###

### Log 3: Exportação de relatório
POST {{baseUrl}}/audit-logs
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "user_id": "{{userId}}",
  "action": "EXPORT_REPORT",
  "tabela_afetada": "relatorios",
  "detalhes_alteracao": {
    "tipo_relatorio": "cotacoes_mensais",
    "formato": "XLSX",
    "periodo": "2025-10"
  }
}

###

### Log 4: Mudança de senha
POST {{baseUrl}}/audit-logs
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "user_id": "{{userId}}",
  "action": "PASSWORD_CHANGE",
  "detalhes_alteracao": {
    "metodo": "manual",
    "ip": "192.168.1.100"
  }
}

###

### Log 5: Atualização em lote
POST {{baseUrl}}/audit-logs
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "user_id": "{{userId}}",
  "action": "BULK_UPDATE",
  "tabela_afetada": "produtos",
  "detalhes_alteracao": {
    "campo_atualizado": "preco",
    "quantidade_registros": 150,
    "percentual_aumento": 10
  }
}

### ============================================
### 19. BUSCAR LOGS DE AÇÕES DE SEGURANÇA
### ============================================
GET {{baseUrl}}/audit-logs?action=USER_LOGIN&limit=100
Authorization: Bearer {{token}}

### ============================================
### 20. BUSCAR LOGS DE EXCLUSÕES
### ============================================
GET {{baseUrl}}/audit-logs?action=DELETE_PRODUCT&limit=100
Authorization: Bearer {{token}}
